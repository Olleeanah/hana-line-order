
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>èŠ±ç”°èˆ é»é¤ç³»çµ±</title>
  <style>
    :root {
      --bg-page: #fefaf5;
      --bg-card: #fffaf7;
      --bg-accent: #fcecef;
      --color-primary: #3e2d2f;
      --color-secondary: #6b4f3b;
      --color-text: #5c4033;
      --color-border: #e8e2db;
      --color-border-light: #e0dcd5;
      --btn-bg: #d58ca3;
      --btn-text: #fff;
      --btn-hover: linear-gradient(to right, #f4b6c6, #fbd0dc);
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Segoe UI", sans-serif;
      background: var(--bg-page);
      padding: 1rem;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin: 0.5rem 0;
      font-size: 2rem;
      color: var(--color-primary);
    }

    .section-title {
      font-size: 1.3rem;        /* å­—é«”å¤§å° */
      font-weight: 500;         /* åŸæœ¬ 600 æ”¹æˆ 500 è¼ƒæŸ”å’Œ */
      margin-top: 1.2rem;
      padding: 0.4rem 0;
      background: #fdf1e9;
      color: #3e2d2f;
      border-bottom: 1.2px solid #f0d8c0;
      border-radius: 6px;
    }

    .section-subtitle {
      font-size: 1.1rem;
      font-weight: 500;
      color: #5c4033;
      background: #fffdf9;
      padding: 0.4rem 0.6rem;
      margin-top: 0.8rem;
      margin-bottom: 0.5rem;
      border-left: 4px solid #f0cda6;
      border-radius: 6px;
    }



    .product-group {
      margin-bottom: 1.2rem;
    }


    .section-instruction {
      text-align: center;
      color: var(--color-secondary);
      margin: 1rem 0;
      font-size: 1rem;
    }
    .card {
      background: var(--bg-card);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 0.5rem;
      line-height: 1.6;
    }

    .card-accent {
      background: #fef1f3;
      border: 1px solid #f5c3cc;
      color: #5c4033;
    }

    .card-info {
        background: #fff5e9;
        border: 1px solid #f0d8c0;
        color: #5c4033;
    }

    #productList {
      margin-top: 0.5rem;
    }
    .product {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid var(--color-border);
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      background-color: #fff;
    }
    .product .name {
      flex: 1;
      color: var(--color-primary);
    }
    .counter {
      display: flex;
      align-items: center;
    }
    .counter button {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--btn-bg);
      color: var(--btn-text);
      font-size: 1.2rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .counter button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .counter span {
      display: inline-block;
      width: 32px;
      text-align: center;
      margin: 0 0.5rem;
    }

    .qty-input {
      width: 60px;
      text-align: center;
      font-size: 1rem;
      padding: 0.25rem 0.5rem;
      border: 1px solid var(--color-border-light);
      border-radius: 6px;
      background: #fffefc;
      color: var(--color-primary);
      margin: 0 0.5rem;
    }


    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid var(--color-border-light);
      border-radius: 6px;
      font-size: 1rem;
      background: #fffefc;
      color: var(--color-primary);
    }
    .summary {
      margin-top: 1rem;
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--color-text);
      text-align: right;
    }
    .submit-btn {
        background: var(--btn-bg);
        color: var(--btn-text);
        font-weight: bold;
        padding: 1.2rem;
        width: 100%;
        border: none;
        border-radius: 12px;
        font-size: 1.4rem;
        cursor: pointer;
        margin-top: 1.5rem;
        box-shadow: 0 4px 10px rgba(213, 140, 163, 0.4);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        animation: pulse 1.6s infinite;
    }

    .submit-btn:hover {
        transform: scale(1.03);
        box-shadow: 0 6px 14px rgba(213, 140, 163, 0.6);
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 rgba(213, 140, 163, 0.4); }
        70% { box-shadow: 0 0 15px rgba(213, 140, 163, 0.8); }
        100% { box-shadow: 0 0 0 rgba(213, 140, 163, 0.4); }
    }

    #resultBox {
      white-space: pre-wrap;
      background: var(--bg-accent);
      border: 1px solid #dfcbd2;
      padding: 1rem;
      border-radius: 6px;
      color: var(--color-text);
      margin-top: 1rem;
      display: none;
    }
    #copyBtn {
      display: none;
    }
    /* LOGO å®¹å™¨ */
    .logo-container {
      text-align: center;
      margin: 1.5rem 0 1rem;
    }
    .logo-container img {
      max-width: 160px;
      height: auto;
      display: block;
      margin: 0 auto 0.3rem;
    }
  </style>
  <!-- åŠ å…¥ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>
  <div class="logo-container">
    <img src="logo.png" alt="èŠ±ç”°èˆ LOGO">
    <h1>é»é¤ç³»çµ±</h1>
  </div>

  <!-- ç‡Ÿæ¥­ç‹€æ…‹é¢æ¿ -->
    <div id="storeStatusPanel" class="w-full my-4 p-4 rounded-xl shadow-md text-center text-lg font-bold">
    <span id="storeStatus" class="text-gray-500 animate-pulse">è¼‰å…¥ä¸­...</span>
    </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://hana-order-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const storeStatusEl = document.getElementById("storeStatus");
    const storeStatusPanel = document.getElementById("storeStatusPanel");

    onValue(ref(db, "status/open"), (snapshot) => {
    const isOpen = snapshot.val();

    storeStatusEl.textContent = isOpen ? "âœ… èŠ±ç”°èˆç›®å‰ç‡Ÿæ¥­ä¸­" : "ğŸ”´ èŠ±ç”°èˆç›®å‰å·²æ‰“çƒŠ";
    storeStatusEl.classList.remove("animate-pulse");

    storeStatusPanel.className =
  "w-full my-6 p-6 rounded-2xl shadow-xl text-center text-2xl font-extrabold tracking-wide transition-all duration-500 " +
  (isOpen
    ? "bg-green-200 text-green-800 border-4 border-green-500 ring ring-green-300"
    : "bg-red-200 text-red-800 border-4 border-red-500 ring ring-red-300");

    });

    onValue(ref(db, "soldout"), (snapshot) => {
        const soldoutMap = snapshot.val(); // { "æ¿ƒéƒå¡å£«é”": true, "æ³•å¼å¥¶é…¥": false, ... }

        document.querySelectorAll(".product").forEach((productDiv) => {
            const name = productDiv.querySelector(".name").textContent.split(" - ")[0].trim();
            const plusBtn = productDiv.querySelector(".plus-btn");

            if (soldoutMap && soldoutMap[name] === true) {
            plusBtn.disabled = true;
            plusBtn.textContent = "å®Œ";
            plusBtn.style.background = "#bbb";
            plusBtn.style.cursor = "not-allowed";
            productDiv.style.opacity = "0.6";
            } else {
            plusBtn.disabled = false;
            plusBtn.textContent = "+";
            plusBtn.style.background = ""; // å›å¾©åŸæœ¬æŒ‰éˆ•æ¨£å¼
            plusBtn.style.cursor = "";
            productDiv.style.opacity = "1";
            }
        });
    });

  </script>

  <div class="section-title">ğŸŒ± æˆ‘å€‘çš„å …æŒ</div>
  <div class="card card-accent">
    <ul style="padding-left: 1.2rem; list-style: none;">
      <li>ğŸ’› èŠ±ç”°èˆï¼Œå°±åƒçµ¦å®¶äººåƒçš„ä¸€æ¨£ <strong>å®‰å¿ƒ</strong></li>
      <li>âœ… æ¯æ—¥ç¾æ‰“ <strong>ç´”å¤©ç„¶éºµç³Š</strong>ï¼Œç„¡äººå·¥æ·»åŠ ã€ç„¡é¦™ç²¾</li>
      <li>ğŸ¥š æ‰€æœ‰å£å‘³çš†ç‚º <strong>ã€Œè›‹å¥¶ç´ ã€</strong></li>
    </ul>
  </div>

  <div class="section-title">ğŸ ç‡Ÿæ¥­æ™‚é–“</div>
  <div class="card card-info">
    â–¸ <strong>é€±ä¸€è‡³é€±äº”ï¼š</strong> ä¸‹åˆ3é» ~ æ™šä¸Š7é»<br>
    â–¸ <strong>é€±å…­ã€é€±æ—¥ï¼š</strong> ä¸‹åˆ2é»30åˆ† ~ æ™šä¸Š7é»<br> 
   
    <span style="margin-left: 1.5em; color: #666;">â€» è‹¥ææ—©å”®å®Œæœƒæå‰æ”¶æ”¤å”· ğŸ¾</span>
  </div>
  <div style="font-size:0.95rem; margin-top:0.25rem;">
    â€» <strong>æœ€æ—©å¯å–é¤æ™‚é–“ï¼š</strong> å¹³æ—¥ 15:10ã€é€±æœ« 14:40ï¼ˆå› éœ€ç¾å ´çƒ˜çƒ¤æº–å‚™ â˜•ï¼‰
  </div>

  <div class="section-title">ğŸ“ ç‡Ÿæ¥­åœ°é»</div>
  <div class="card card-info">å½°åŒ–ç¸£æºªæ¹–é®è¥¿ç’°è·¯241è™Ÿ</div>

  <div class="section-title">ğŸ“… åº—ä¼‘æ—¥</div>
  <ul class="card card-info" style="list-style:none; padding-left:1.5rem;">
    <li> 1/21(ä¸‰) åº—ä¼‘ </li>
  
    
  </ul>

  <div style="font-size:0.95rem; color:#444; margin-top:0.25rem;">
    â€» å¤å­£æœŸé–“ï¼Œ<strong>è‹¥é‡é¢±é¢¨æˆ–å¤©æ°£ä¸ä½³</strong>ï¼Œå¯èƒ½è‡¨æ™‚åº—ä¼‘ ğŸŒ€è«‹ç•™æ„ LINE æˆ– IG æœ€æ–°é€šçŸ¥ ğŸ™
  </div>

  <div class="section-title">â³ æœŸé–“é™å®š</div>
  <div class="card card-accent">

    
      <p style="font-size:1.05rem; line-height:1.6; color:#5c4033; margin-bottom:0.8rem;">

        <p style="font-size:1.05rem; line-height:1.6; color:#5c4033; margin-bottom:0.8rem;">
          <strong>æ•¬è«‹æœŸå¾…ï½</strong><br>
          
          

        </p>

        
        
      </p>
        
          
    <ul style="padding-left: 1.2rem; list-style: none;">
      <li>âš ï¸ å»ºè­°æå‰é è¨‚é¿å…ä¹…å€™ ğŸ™Œ</li>
      <li>ğŸš— åœ˜é«”è¨‚è³¼å¯å¤–é€ï¼Œå¯é–‹æ”¶æ“š</li>
    </ul>

  </div>


  <div class="section-title">ğŸ£ å“é …</div>
  <div id="productList"></div>
  <div class="summary" id="summary">ç¸½é‡‘é¡ï¼š$0ï½œç¸½é¡†æ•¸ï¼š0</div>

  

  <div class="section-title">âœï¸ å…¶ä»–è³‡è¨Š</div>
  <form id="orderForm" novalidate>
    
    <label for="customerName">ç¨±è¬‚</label>
    <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå°èŠ±ã€å¼µå°å§">

    <label for="phone">é›»è©±è™Ÿç¢¼</label>
    <input type="tel" id="phone" placeholder="0912345678" pattern="[0-9]{9,10}" required>

    <label for="pickupDate">å–é¤æ—¥æœŸ</label>
    <input type="date" id="pickupDate" required>

    <label for="pickupTime">å–é¤æ™‚é–“</label>
    <select id="pickupTime" required></select>

    <label for="note">å‚™è¨»</label>
    <textarea id="note" rows="3" placeholder="ä¾‹å¦‚ï¼šè›‹å…¨ç†Ÿã€è›‹åŠç†Ÿç­‰..."></textarea>
    

      <hr style="border: none; border-top: 1px solid #e5d9cf; margin: 1rem 0 0.8rem;" />


    <p class="section-instruction">â¬‡ï¸ é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œå†è¤‡è£½æ–‡å­—è²¼çµ¦æˆ‘å€‘ â˜ºï¸</p>
    <button type="button" class="submit-btn" id="generateBtn">ğŸ§¾ ç”¢ç”Ÿè¨‚å–®æ–‡å­—</button>
  </form>

  <div id="resultBox"></div>
  <button class="submit-btn" id="copyBtn">ğŸ“‹ è¤‡è£½è¨‚å–®æ–‡å­—</button>

  <script>
  (function() {
    const products = [
      { name: "ç¶“å…¸è›‹ç‡’", price: 33, category: "é¹¹å£å‘³" },
      { name: "èµ·å¸è›‹ç‡’", price: 40, category: "é¹¹å£å‘³" },
      { name: "é›™é‡èµ·å¸", price: 30, category: "é¹¹å£å‘³" },

      { name: "æ¿ƒéƒå¡å£«é”", price: 25, category: "ç”œå£å‘³" },
      { name: "æ³•å¼å¥¶é…¥", price: 35, category: "ç”œå£å‘³" },
      { name: "èµ·å¸å¥¶é…¥", price: 35, category: "ç”œå£å‘³" },
      { name: "é»‘ç³–éº»ç³¬", price: 33, category: "ç”œå£å‘³" },
      { name: "æ—¥å¼ç´…è±†æ³¥", price: 30, category: "ç”œå£å‘³" },
      { name: "æ—¥å¼ç´…è±†éº»ç³¬", price: 35, category: "ç”œå£å‘³" },

      { name: "å¤æ—©å‘³é›è›‹ç³•", price: 18, category: "åŸå‘³" },

      //{ name: "æ¿ƒæƒ…å·§å…‹åŠ›", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é›ªå¡©é¦™æª¸å¥¶é…¥", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "ç´«ç³¯ç±³èŠ‹æ³¥æ¹¯åœ“", price: 33, category: "é™å®šå£å‘³" },
      //{ name: "çˆ†æ¼¿èŠ±ç”Ÿæ¹¯åœ“", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "çˆ†æ¼¿èŠéº»æ¹¯åœ“", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é›ªå¡©é¦™è‰å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é¦™ç”œç´«è–¯", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "ç´«è–¯Qéº»ç³¬", price: 45, category: "é™å®šå£å‘³" },
      //{ name: "ç´«è–¯èµ·å¸", price: 45, category: "é™å®šå£å‘³" },
      //{ name: "ğŸ’œè—è“å¡å£«é”", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "ğŸ˜ˆè—è“å¡å£«é” OREO", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "è‰è“å¥¶é…¥ğŸ“", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "éµè§€éŸ³å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é¦™è•‰å·§å…‹åŠ›", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "èŠ±ç”Ÿå·§å…‹åŠ›", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "ç‰ç±³è›‹ç‡’", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é¹¹é¦™èŠ±ç”Ÿ", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "èŠ±ç”Ÿå¡å£«é”", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "é»‘ç³–å¡å£«é”", price: 28, category: "é™å®šå£å‘³" },
      //{ name: "åˆæˆ€è‰è“å¡å£«é”", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "è‰è“Oreo", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é¦™ç”œç‰ç±³èµ·å¸ğŸŒ½", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "éµè§€éŸ³å¥¶é…¥", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "çç éµè§€éŸ³å¥¶é…¥", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "å¤§æºªåœ°é¦™è‰å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "èŠ’æœå¡å£«é”", price: 33, category: "é™å®šå£å‘³" },

      { name: "ç’°ä¿æè¢‹", price: 2, category: "å…¶ä»–" }
    ];

    const disabledProducts = {
      //'é»‘ç³–éº»ç³¬': 'è£œè²¨ä¸­',
      // 'è‡¨æ™‚å”®å®Œçš„å“é …ï¼Œæœ‰è²¨å°±åˆªæ‰ä¸Šé¢é‚£è¡Œ'
    };


    const holidays = new Set(['2026-01-21']);//åº—ä¼‘æ—¥
    const state = {};

    const productListEl = document.getElementById('productList');
    const summaryEl = document.getElementById('summary');
    const dateInput = document.getElementById('pickupDate');
    const timeSelect = document.getElementById('pickupTime');
    const generateBtn = document.getElementById('generateBtn');
    const resultBox = document.getElementById('resultBox');
    const copyBtn = document.getElementById('copyBtn');

    function renderProducts() {
      const frag = document.createDocumentFragment();

      const emojis = {
        "é¹¹å£å‘³": "ğŸ§‚",
        "ç”œå£å‘³": "ğŸ°",
        "åŸå‘³": "ğŸ¥š",
        "é™å®šå£å‘³": "â³",
        "å…¶ä»–": "ğŸŒ±"
      };

      const categories = ["é¹¹å£å‘³", "ç”œå£å‘³", "åŸå‘³", "é™å®šå£å‘³", "å…¶ä»–"];

      categories.forEach(cat => {
        const filtered = products
          .map((item, idx) => ({ item, idx }))
          .filter(({ item }) => item.category === cat);

        if (filtered.length === 0) return; // âœ… æ²’æœ‰è©²åˆ†é¡å•†å“å°±è·³é

        const group = document.createElement('div');
        group.className = 'product-group';

        const subtitle = document.createElement('div');
        subtitle.className = 'section-subtitle';
        subtitle.textContent = `${emojis[cat] || "ğŸ½ï¸"} ${cat}`;
        group.appendChild(subtitle);

        filtered.forEach(({ item, idx }) => {
          state[item.name] = 0;
          const div = document.createElement('div');
          div.className = 'product';

          const isDisabled = item.name in disabledProducts;

          div.innerHTML = `
            <div class="name">${item.name} - $${item.price}</div>
            ${isDisabled ? `<div style="font-size: 0.85rem; color: #a35b5b; margin: 0.3rem 0 0.2rem;">â€» ${disabledProducts[item.name]}</div>` : ''}
            <div class="counter" data-index="${idx}">
              <button class="minus-btn" disabled>-</button>
              <input type="number" class="qty-input" id="qty-${idx}" value="0" min="0">
              <button class="plus-btn" ${isDisabled ? 'disabled' : ''}>+</button>
            </div>

          `;

          group.appendChild(div);

          if (item.name === "ç’°ä¿æè¢‹") {
            const tip = document.createElement('div');
            tip.style.cssText = "font-size: 0.9rem; color: #6a4f3b; margin: 0.3rem 0 0.8rem 0.5rem;";
            tip.textContent = " æ„›è­·åœ°çƒï¼Œæ­¡è¿è‡ªå‚™è³¼ç‰©è¢‹ â™»ï¸";
            group.appendChild(tip);
          }
        });



        frag.appendChild(group);

      });
      productListEl.appendChild(frag);
    }


    function updateSummary() {
      let total = 0, count = 0;
      products.forEach(item => {
        const qty = state[item.name] || 0;
        total += qty * item.price;
        if (item.name !== 'ç’°ä¿æè¢‹') count += qty;
      });

      

      summaryEl.textContent = `ç¸½é‡‘é¡ï¼š$${total}ï½œç¸½é¡†æ•¸ï¼š${count}`;
      return { total, count };
    }

    function changeQty(idx, diff) {
      const item = products[idx];
      const newQty = Math.max(0, (state[item.name] || 0) + diff);
      state[item.name] = newQty;

      const inputEl = document.getElementById(`qty-${idx}`);
      inputEl.value = newQty;

      const container = productListEl.querySelector(`.counter[data-index="${idx}"]`);
      container.querySelector('.minus-btn').disabled = newQty === 0;

      updateSummary();
    }


    function generateTimeSlots() {
      timeSelect.innerHTML = '';
      const val = dateInput.value;
      if (!val || holidays.has(val)) return;

      const d = new Date(val);
      const day = d.getDay();
      const isToday = val === new Date().toISOString().split('T')[0];

      const earlyOpenDays = new Set(['2025-08-08']); // â¬…ï¸ æƒ³ææ—©ç‡Ÿæ¥­å“ªå¤©å°±åœ¨é€™åŠ 
      const isEarlyOpenDay = earlyOpenDays.has(val);
      const isWeekend = (day === 0 || day === 6);
      const useWeekendTime = isWeekend || isEarlyOpenDay;

      const baseHour = useWeekendTime ? 14 : 15;
      const baseMin = useWeekendTime ? 40 : 10;


      let nowHour = 0, nowMin = 0;
      if (isToday) {
        const now = new Date();
        nowHour = now.getHours();
        nowMin = now.getMinutes();
      }

      for (let h = baseHour; h < 19; h++) {
        for (let m = 0; m < 60; m += 10) {
          if (h === baseHour && m < baseMin) continue;
          if (isToday && (h < nowHour || (h === nowHour && m <= nowMin))) continue;

          const hh = String(h).padStart(2, '0');
          const mm = String(m).padStart(2, '0');
          const opt = document.createElement('option');
          opt.value = `${hh}:${mm}`;
          opt.textContent = `${hh}:${mm}`;
          timeSelect.appendChild(opt);
        }
      }
    }


    function validateForm({ total, count }) {
      if (count === 0) {
        alert('è«‹é¸æ“‡è‡³å°‘ä¸€é …å“é …');
        return false;
      }
      if (!dateInput.value) {
        alert('è«‹é¸æ“‡å–é¤æ—¥æœŸ'); return false;
      }
      if (holidays.has(dateInput.value)) {
        alert('æ­¤æ—¥ç‚ºå…¬ä¼‘æ—¥ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸ'); return false;
      }
      if (!timeSelect.value) {
        alert('è«‹é¸æ“‡å–é¤æ™‚é–“'); return false;
      }
      const phone = document.getElementById('phone');
      if (!phone.checkValidity()) {
        alert('è«‹è¼¸å…¥æ­£ç¢ºé›»è©±è™Ÿç¢¼'); phone.focus(); return false;
      }
      return true;
    }

    function generateOrder() {
      const { total, count } = updateSummary();
      if (!validateForm({ total, count })) return;
      const name = document.getElementById('customerName').value || 'é¡§å®¢';
      const phone = document.getElementById('phone').value;
      localStorage.setItem('customerName', name);
      localStorage.setItem('customerPhone', phone);
      const date = dateInput.value;
      const time = timeSelect.value;
      const note = document.getElementById('note').value;
      let text = `ã€èŠ±ç”°èˆå°åˆ¤ç‡’ é è¨‚å–®ã€‘\n` +
                 `ç¨±è¬‚ï¼š${name}\né›»è©±ï¼š${phone}\nå–é¤æ™‚é–“ï¼š${date} ${time}\n` +
                 `ç¸½é‡‘é¡ï¼š$${total}\nç¸½é¡†æ•¸ï¼š${count}\nè¨‚è³¼å…§å®¹ï¼š`;
      products.forEach(item => {
        const qty = state[item.name];
        if (qty > 0) text += `\n- ${item.name} x${qty}`;
      });



      if (note) text += `\nå‚™è¨»ï¼š${note}`;
      text += `\nâ— æœ‰æ”¶åˆ°åº—å®¶å›è¦†æ‰ä»£è¡¨è¨‚é¤æˆåŠŸå–”ï¼`;
      resultBox.textContent = text;
      resultBox.style.display = 'block';
      copyBtn.style.display = 'block';
      resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(resultBox.textContent)
        .then(() => alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œè«‹è²¼åˆ° LINE å‚³é€ï¼'));
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderProducts();
      updateSummary();
      // âœ… å¾ localStorage è®€å–
        const savedName = localStorage.getItem('customerName');
        const savedPhone = localStorage.getItem('customerPhone');
        if (savedName) document.getElementById('customerName').value = savedName;
        if (savedPhone) document.getElementById('phone').value = savedPhone;

      productListEl.addEventListener('click', e => {
        const counter = e.target.closest('.counter');
        if (!counter) return;
        const idx = Number(counter.dataset.index);
        if (e.target.classList.contains('plus-btn')) changeQty(idx, 1);
        if (e.target.classList.contains('minus-btn')) changeQty(idx, -1);
      });

      // âœ… â• ç¨ç«‹ç›£è½è¼¸å…¥æ¡†è®Šå‹•
      productListEl.addEventListener('input', e => {
        if (!e.target.classList.contains('qty-input')) return;

        const idx = Number(e.target.closest('.counter').dataset.index);
        const item = products[idx];
        let value = parseInt(e.target.value, 10);

        if (isNaN(value) || value < 0) value = 0;

        state[item.name] = value;
        e.target.value = value;

        const container = e.target.closest('.counter');
        const minusBtn = container.querySelector('.minus-btn');
        minusBtn.disabled = value === 0;

        updateSummary();
      });


      const today = new Date().toISOString().split('T')[0];
      dateInput.min = today;
      dateInput.addEventListener('change', () => {
        if (!dateInput.value) return;
        if (holidays.has(dateInput.value)) {
          alert('æ­¤æ—¥ç‚ºå…¬ä¼‘æ—¥'); dateInput.value = '';
          timeSelect.innerHTML = '';
          return;
        }
        generateTimeSlots();
      });
      generateBtn.addEventListener('click', generateOrder);
      copyBtn.addEventListener('click', copyToClipboard);

      let hasShownLatePickupNotice = false;

      document.getElementById('pickupTime').addEventListener('change', function () {
        const selected = this.value;
        if (!selected) return;

        const [hour, minute] = selected.split(':').map(Number);
        const selectedMinutes = hour * 60 + minute;

        if (selectedMinutes > 17 * 60 + 30 && !hasShownLatePickupNotice) {
          hasShownLatePickupNotice = true;
          alert(`â€» èŠ±ç”°èˆçš„å°åˆ¤ç‡’éƒ½æ˜¯ã€Œç¾é»ç¾åšã€æ¯æ—¥æ–°é®®é™é‡ã€ã€‚\n\nè‹¥æ‚¨é å®šçš„å–é¤æ™‚é–“è¶…é 17:30ï¼Œæˆ‘å€‘æœƒç›¡åŠ›ç‚ºæ‚¨ä¿ç•™ï¼Œä½†æœ‰æ™‚ç¾å ´å®¢äººè¼ƒå¤šï¼Œå¯èƒ½æœƒæå‰è³£å®Œã€‚\n\nè‹¥ç•¶æ—¥å·²å”®å®Œï¼Œæˆ‘æœƒä¸»å‹•é€é LINE è¨Šæ¯é€šçŸ¥æ‚¨å–æ¶ˆé è¨‚å–®ï¼Œè¬è¬æ‚¨çš„é«”è«’èˆ‡æ”¯æŒï½ ğŸ’›`);
        }
      });

    });
  })();
  </script>
  <script>
    // è‡ªå‹•é™„åŠ ç¶²å€åƒæ•¸ï¼Œé¿å…å¿«å–
    (function () {
        const url = new URL(window.location.href);
        const timestamp = Date.now().toString();
        if (!url.searchParams.has('v')) {
        url.searchParams.set('v', timestamp);
        window.location.replace(url.href);
        }
    })();
</script>
</body>
</html>
