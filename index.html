<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>èŠ±ç”°èˆ é»é¤ç³»çµ±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;500;600&family=Zen+Maru+Gothic:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-page: #f9f6f0;
      --bg-card: #fffef9;
      --bg-accent: #fef5e7;
      --color-primary: #4a3c2e;
      --color-secondary: #7a6550;
      --color-text: #5c4f3d;
      --color-border: #d4c5b0;
      --color-border-light: #e5dac8;
      --btn-bg: #c89b7b;
      --btn-text: #fff;
      --btn-hover: #b88a6a;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Noto Serif TC", "Songti TC", "PingFang TC", serif;
      background: var(--bg-page);
      background-image: 
        repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(220, 210, 190, 0.15) 2px, rgba(220, 210, 190, 0.15) 3px),
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(220, 210, 190, 0.15) 2px, rgba(220, 210, 190, 0.15) 3px);
      padding: 1rem;
      max-width: 600px;
      margin: auto;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="1" cy="1" r="1" fill="%23d4c5b0" opacity="0.3"/></svg>');
      background-size: 40px 40px;
      pointer-events: none;
      z-index: -1;
      opacity: 0.4;
    }
    h1 {
      text-align: center;
      margin: 0.5rem 0;
      font-size: 2rem;
      color: var(--color-primary);
      font-weight: 500;
      letter-spacing: 0.15em;
      text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8);
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 400;
      margin-top: 1.2rem;
      padding: 0.6rem 0.8rem;
      background: linear-gradient(to right, #f5ebe0, #faf6f0);
      color: #3e2d2f;
      border-left: 4px solid #a88968;
      border-radius: 2px;
      box-shadow: 2px 2px 0 rgba(168, 137, 104, 0.15);
      letter-spacing: 0.08em;
    }

    .section-subtitle {
      font-size: 1.1rem;
      font-weight: 400;
      color: #5c4033;
      background: #fffdf9;
      padding: 0.5rem 0.8rem;
      margin-top: 0.8rem;
      margin-bottom: 0.5rem;
      border-left: 3px solid #d4a574;
      border-radius: 2px;
      box-shadow: 1px 1px 0 rgba(212, 165, 116, 0.2);
      letter-spacing: 0.05em;
    }



    .product-group {
      margin-bottom: 1.2rem;
    }


    .section-instruction {
      text-align: center;
      color: var(--color-secondary);
      margin: 1rem 0;
      font-size: 1rem;
    }
    .card {
      background: var(--bg-card);
      border: 1.5px solid var(--color-border);
      border-radius: 4px;
      padding: 1rem;
      margin-top: 0.5rem;
      line-height: 1.8;
      box-shadow: 3px 3px 0 rgba(180, 160, 130, 0.15);
      position: relative;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 4px;
      left: 4px;
      right: 4px;
      bottom: 4px;
      border: 1px solid rgba(212, 197, 176, 0.3);
      border-radius: 2px;
      pointer-events: none;
    }

    .card-accent {
      background: #fef9f3;
      border: 1.5px solid #d4a574;
      color: #5c4033;
    }

    .card-info {
        background: #fffbf5;
        border: 1.5px solid #c8b299;
        color: #5c4033;
    }

    #productList {
      margin-top: 0.5rem;
    }
    .product {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1.5px solid var(--color-border);
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      border-radius: 3px;
      background-color: #fffefb;
      box-shadow: 2px 2px 0 rgba(180, 160, 130, 0.12);
      transition: all 0.2s ease;
    }
    .product:hover {
      box-shadow: 3px 3px 0 rgba(168, 137, 104, 0.25);
      transform: translate(-1px, -1px);
    }
    .product .name {
      flex: 1;
      color: var(--color-primary);
      font-weight: 400;
      letter-spacing: 0.03em;
    }
    .counter {
      display: flex;
      align-items: center;
    }
    .counter button {
      width: 32px;
      height: 32px;
      border: 1.5px solid #a88968;
      background: var(--btn-bg);
      color: var(--btn-text);
      font-size: 1.2rem;
      border-radius: 2px;
      cursor: pointer;
      box-shadow: 2px 2px 0 rgba(168, 137, 104, 0.2);
      transition: all 0.15s ease;
      font-family: "Noto Sans TC", sans-serif;
    }
    .counter button:hover:not(:disabled) {
      background: var(--btn-hover);
      transform: translate(-1px, -1px);
      box-shadow: 3px 3px 0 rgba(168, 137, 104, 0.3);
    }
    .counter button:active:not(:disabled) {
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0 rgba(168, 137, 104, 0.2);
    }
    .counter button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }
    .counter span {
      display: inline-block;
      width: 32px;
      text-align: center;
      margin: 0 0.5rem;
    }

    .qty-input {
      width: 60px;
      text-align: center;
      font-size: 1rem;
      padding: 0.3rem 0.5rem;
      border: 1.5px solid var(--color-border-light);
      border-radius: 2px;
      background: #fffefb;
      color: var(--color-primary);
      margin: 0 0.5rem;
      font-family: "Noto Sans TC", sans-serif;
      box-shadow: inset 1px 1px 2px rgba(0, 0, 0, 0.05);
    }


    input, select, textarea {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1.5px solid var(--color-border-light);
      border-radius: 3px;
      font-size: 1rem;
      background: #fffefb;
      color: var(--color-primary);
      font-family: "Noto Sans TC", sans-serif;
      box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.05);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #a88968;
      box-shadow: inset 1px 1px 3px rgba(0, 0, 0, 0.08), 0 0 0 2px rgba(168, 137, 104, 0.15);
    }
    .summary {
      margin-top: 1rem;
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--color-text);
      text-align: right;
      letter-spacing: 0.05em;
    }
    .submit-btn {
        background: var(--btn-bg);
        color: var(--btn-text);
        font-weight: 500;
        padding: 1.2rem;
        width: 100%;
        border: 2px solid #a88968;
        border-radius: 4px;
        font-size: 1.4rem;
        cursor: pointer;
        margin-top: 1.5rem;
        box-shadow: 4px 4px 0 rgba(168, 137, 104, 0.25);
        transition: all 0.2s ease;
        font-family: "Noto Serif TC", serif;
        letter-spacing: 0.1em;
    }

    .submit-btn:hover {
        background: var(--btn-hover);
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 rgba(168, 137, 104, 0.3);
    }

    .submit-btn:active {
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0 rgba(168, 137, 104, 0.2);
    }

    #resultBox {
      white-space: pre-wrap;
      background: var(--bg-accent);
      border: 1.5px solid #d4a574;
      padding: 1rem;
      border-radius: 4px;
      color: var(--color-text);
      margin-top: 1rem;
      display: none;
      box-shadow: 3px 3px 0 rgba(180, 160, 130, 0.15);
      font-family: "Noto Sans TC", sans-serif;
      line-height: 1.8;
    }
    #copyBtn {
      display: none;
    }
    /* LOGO å®¹å™¨ */
    .logo-container {
      text-align: center;
      margin: 1.5rem 0 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 4px;
      box-shadow: 2px 2px 0 rgba(180, 160, 130, 0.1);
    }
    .logo-container img {
      max-width: 160px;
      height: auto;
      display: block;
      margin: 0 auto 0.3rem;
      filter: contrast(0.95) brightness(1.05);
    }

    /* ç‡Ÿæ¥­ç‹€æ…‹é¢æ¿æ‰‹ä½œé¢¨æ ¼ */
    #storeStatusPanel {
      margin: 1.5rem 0;
      padding: 1rem;
      border-radius: 4px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: 500;
      letter-spacing: 0.08em;
      box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
      border: 2px solid;
      font-family: "Noto Sans TC", sans-serif;
    }

  </style>
  
  <!-- åŠ å…¥ Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body>
  <div class="logo-container">
    <img src="logo.png" alt="èŠ±ç”°èˆ LOGO">
    <h1>é»é¤ç³»çµ±</h1>
  </div>

  <!-- ç‡Ÿæ¥­ç‹€æ…‹é¢æ¿ -->
    <div id="storeStatusPanel" class="w-full my-4 p-4 rounded-xl shadow-md text-center text-lg font-bold">
    <span id="storeStatus" class="text-gray-500 animate-pulse">è¼‰å…¥ä¸­...</span>
    </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://hana-order-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const storeStatusEl = document.getElementById("storeStatus");
    const storeStatusPanel = document.getElementById("storeStatusPanel");

    onValue(ref(db, "status/open"), (snapshot) => {
    const isOpen = snapshot.val();

    storeStatusEl.textContent = isOpen ? "âœ… èŠ±ç”°èˆç›®å‰ç‡Ÿæ¥­ä¸­" : "ğŸ”´ èŠ±ç”°èˆç›®å‰å·²æ‰“çƒŠ";
    storeStatusEl.classList.remove("animate-pulse");

    storeStatusPanel.className =
  "w-full my-6 p-6 rounded-2xl shadow-xl text-center text-2xl font-extrabold tracking-wide transition-all duration-500 " +
  (isOpen
    ? "bg-green-200 text-green-800 border-4 border-green-500 ring ring-green-300"
    : "bg-red-200 text-red-800 border-4 border-red-500 ring ring-red-300");

    });

    onValue(ref(db, "soldout"), (snapshot) => {
        const soldoutMap = snapshot.val(); // { "æ¿ƒéƒå¡å£«é”": true, "æ³•å¼å¥¶é…¥": false, ... }

        document.querySelectorAll(".product").forEach((productDiv) => {
            const name = productDiv.querySelector(".name").textContent.split(" - ")[0].trim();
            const plusBtn = productDiv.querySelector(".plus-btn");

            if (soldoutMap && soldoutMap[name] === true) {
            plusBtn.disabled = true;
            plusBtn.textContent = "å®Œ";
            plusBtn.style.background = "#bbb";
            plusBtn.style.cursor = "not-allowed";
            productDiv.style.opacity = "0.6";
            } else {
            plusBtn.disabled = false;
            plusBtn.textContent = "+";
            plusBtn.style.background = ""; // å›å¾©åŸæœ¬æŒ‰éˆ•æ¨£å¼
            plusBtn.style.cursor = "";
            productDiv.style.opacity = "1";
            }
        });
    });

  </script>

  <div class="section-title">ğŸŒ± æˆ‘å€‘çš„å …æŒ</div>
  <div class="card card-accent">
    <ul style="padding-left: 1.2rem; list-style: none;">
      <li>ğŸ’› èŠ±ç”°èˆï¼Œå°±åƒçµ¦å®¶äººåƒçš„ä¸€æ¨£ <strong>å®‰å¿ƒ</strong></li>
      <li>âœ… æ¯æ—¥ç¾æ‰“<strong>ç´”å¤©ç„¶éºµç³Š</strong>ï¼Œç„¡äººå·¥æ·»åŠ </li>
      <li>ğŸ¥š æ‰€æœ‰å£å‘³çš†ç‚º <strong>ã€Œè›‹å¥¶ç´ ã€</strong></li>
    </ul>
  </div>

  <div class="section-title">ğŸ ç‡Ÿæ¥­æ™‚é–“</div>
  <div class="card card-info">
    â–¸ <strong>é€±ä¸€è‡³é€±äº”ï¼š</strong> ä¸‹åˆ3é» ~ æ™šä¸Š7é»<br>
    â–¸ <strong>é€±å…­ã€é€±æ—¥ï¼š</strong> ä¸‹åˆ2é»30åˆ† ~ æ™šä¸Š7é»<br> 
   
    <span style="margin-left: 1.5em; color: #666;">â€» è‹¥ææ—©å”®å®Œæœƒæå‰æ”¶æ”¤å”· ğŸ¾</span>
  </div>
  <div style="font-size:0.95rem; margin-top:0.25rem;">
    â€» <strong>æœ€æ—©å¯å–é¤æ™‚é–“ï¼š</strong> å¹³æ—¥ 15:10ã€é€±æœ« 14:40ï¼ˆå› éœ€ç¾å ´çƒ˜çƒ¤æº–å‚™ â˜•ï¼‰
  </div>

  <div class="section-title">ğŸ“ ç‡Ÿæ¥­åœ°é»</div>
  <div class="card card-info">å½°åŒ–ç¸£æºªæ¹–é®è¥¿ç’°è·¯241è™Ÿ</div>

  <div class="section-title">ğŸ“… åº—ä¼‘æ—¥</div>
  <ul class="card card-info" style="list-style:none; padding-left:1.5rem;">
    
    <li>2/25(ä¸‰) åº—ä¼‘</li>
  
    
  </ul>

  <div style="font-size:0.95rem; color:#444; margin-top:0.25rem;">
    â€» å¤å­£æœŸé–“ï¼Œ<strong>è‹¥é‡é¢±é¢¨æˆ–å¤©æ°£ä¸ä½³</strong>ï¼Œå¯èƒ½è‡¨æ™‚åº—ä¼‘ ğŸŒ€è«‹ç•™æ„ LINE æˆ– IG æœ€æ–°é€šçŸ¥ ğŸ™
  </div>

  <div class="section-title">â³ æœŸé–“é™å®š</div>
  <div class="card card-accent">

    
      <p style="font-size:1.05rem; line-height:1.6; color:#5c4033; margin-bottom:0.8rem;">

          <!-- <strong>æ¿ƒæƒ…å·§å…‹åŠ› $38</strong><br>
          èŠ±ç”°èˆæ–°é®®ç‰¹èª¿ï¼Œæ¿ƒéƒçš„è‹¦ç”œå·§å…‹åŠ›ç”˜ç´è¨±ï¼Œä¸€å£å’¬ä¸‹è¶…æ»¿è¶³ï½âœ¨<br> <br>  -->
          
          <!-- <strong>è—è“å¡å£«é” $35</strong><br>
          èŠ±ç”°èˆæ‰‹å·¥ç†¬ç…®è—è“é†¬ï¼Œæ­é…æ¿ƒéƒå¡å£«é”<br><br> -->
          <!-- <strong>è–¯é¤…èµ·å¸ $43</strong><br>
          é¦™è„†è–¯é¤…æ­é…é›™é‡èµ·å¸ï¼Œçµåˆé›è›‹ç³•ï¼Œé¹¹ç”œå¥½ç¾å‘³<br><br>  -->
    
          <strong>æ•¬è«‹æœŸå¾…ï½âœ¨</strong><br>

             <!-- <strong style="font-size: 1.3rem;">ğŸ§§ æ–°å¹´çš„æŒå¿ƒæº«æš– â€§ é™é‡åˆ†äº« </strong><br>
            <span style="font-style: italic; color: #8b4513;">ã€Œæ¯ä¸€ä»½æ‰‹ä½œï¼Œéƒ½æ˜¯ç¨ä¸€ç„¡äºŒçš„ç¥ç¦ã€</span><br>
            è¾²æ›†æ˜¥ç¯€ï¼ŒèŠ±ç”°èˆæƒ³æŠŠæ‰‹ä½œçš„æº«åº¦ï¼Œå‚³éçµ¦æ”¯æŒæˆ‘å€‘çš„æœ‹å‹å€‘ â¤ï¸<br>
            ğŸ é™é‡åŠ è³¼ï¼ˆç¸½å…±åªæœ‰ 2 ä»¶ï¼Œå”®å®Œç‚ºæ­¢ï¼‰<br>
            è³¼è²·é›è›‹ç³•æ»¿ 168 å…ƒï¼Œå³å¯ä»¥79å…ƒåŠ è³¼ã€Œæ‰‹ä½œé›™å±¤å¸ƒç´…åŒ…è¢‹ã€1 ä»¶<br>
            â­ å‰ç¥¥ç´…è‰² x1<br>
            â­ å¦‚æ„ç´ºè— x1<br>
            <span style="font-style: italic; color: #703f1c;">ä¹Ÿå¯ä½œç‚ºæ—¥å¸¸æ”¶ç´è¢‹ä½¿ç”¨å–”</span><br><br>
            
          </p>
        <div style="text-align:center; margin-bottom:14px;">
          <img 
            src="red-envelope-handmade.jpg"
            alt="æ˜¥ç¯€æ‰‹ä½œé›™å±¤å¸ƒç´…åŒ…è¢‹"
            id="envelopeImg"
            style="
              width:100%;
              max-width:340px;
              border-radius:14px;
              cursor:pointer;
              box-shadow:0 10px 22px rgba(0,0,0,0.15);
              transition:transform .25s ease;
            "
            onmouseover="this.style.transform='scale(1.03)'"
            onmouseout="this.style.transform='scale(1)'"
          >

          <div style="
              margin-top:8px;
              font-weight:700;
              color:#b14b5c;
              letter-spacing:1px;
            ">
            ğŸ§§ åƒ…æ‰‹ä½œ 2 ä»¶ Â·<br>
          </div>
        </div>
        
        
      </p> -->
        
          
    <ul style="padding-left: 1.2rem; list-style: none;">
      <li>âš ï¸ å»ºè­°æå‰é è¨‚é¿å…ä¹…å€™ ğŸ™Œ</li>
      <li>ğŸš— åœ˜é«”è¨‚è³¼å¯å¤–é€ï¼Œå¯é–‹æ”¶æ“š</li>
    </ul>

  </div>


  <div class="section-title">ğŸ£ å“é …</div>
  <div id="productList"></div>
  <div class="summary" id="summary">ç¸½é‡‘é¡ï¼š$0ï½œç¸½é¡†æ•¸ï¼š0</div>

  

  <div class="section-title">âœï¸ å…¶ä»–è³‡è¨Š</div>
  <form id="orderForm" novalidate>
    
    <label for="customerName">ç¨±è¬‚</label>
    <input type="text" id="customerName" placeholder="ä¾‹å¦‚ï¼šå°èŠ±ã€å¼µå°å§">

    <label for="phone">é›»è©±è™Ÿç¢¼</label>
    <input type="tel" id="phone" placeholder="0912345678" pattern="[0-9]{9,10}" required>

    <label for="pickupDate">å–é¤æ—¥æœŸ</label>
    <input type="date" id="pickupDate" required>

    <label for="pickupTime">å–é¤æ™‚é–“</label>
    <select id="pickupTime" required></select>

    <label for="note">å‚™è¨»</label>
    <textarea id="note" rows="3" placeholder="ä¾‹å¦‚ï¼šè›‹å…¨ç†Ÿã€è›‹åŠç†Ÿç­‰..."></textarea>
    

      <hr style="border: none; border-top: 1px solid #e5d9cf; margin: 1rem 0 0.8rem;" />


    <p class="section-instruction">â¬‡ï¸ é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œå†è¤‡è£½æ–‡å­—è²¼çµ¦æˆ‘å€‘ â˜ºï¸</p>
    <button type="button" class="submit-btn" id="generateBtn">ğŸ§¾ ç”¢ç”Ÿè¨‚å–®æ–‡å­—</button>
  </form>

  <div id="resultBox"></div>
  <button class="submit-btn" id="copyBtn">ğŸ“‹ è¤‡è£½è¨‚å–®æ–‡å­—</button>

  <script>
  (function() {
    const products = [
      { name: "ç¶“å…¸è›‹ç‡’", price: 33, category: "é¹¹å£å‘³" },
      { name: "èµ·å¸è›‹ç‡’", price: 40, category: "é¹¹å£å‘³" },
      { name: "é›™é‡èµ·å¸", price: 30, category: "é¹¹å£å‘³" },

      { name: "æ¿ƒéƒå¡å£«é”", price: 25, category: "ç”œå£å‘³" },
      { name: "æ³•å¼å¥¶é…¥", price: 35, category: "ç”œå£å‘³" },
      { name: "èµ·å¸å¥¶é…¥", price: 35, category: "ç”œå£å‘³" },
      { name: "é»‘ç³–éº»ç³¬", price: 33, category: "ç”œå£å‘³" },
      { name: "æ—¥å¼ç´…è±†æ³¥", price: 30, category: "ç”œå£å‘³" },
      { name: "æ—¥å¼ç´…è±†éº»ç³¬", price: 35, category: "ç”œå£å‘³" },

      { name: "å¤æ—©å‘³é›è›‹ç³•", price: 18, category: "åŸå‘³" },

      //{ name: "è–¯é¤…èµ·å¸", price: 43, category: "é™å®šå£å‘³" },

      //{ name: "æ¿ƒæƒ…å·§å…‹åŠ›", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é›ªå¡©é¦™æª¸å¥¶é…¥", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "ç´«ç³¯ç±³èŠ‹æ³¥æ¹¯åœ“", price: 33, category: "é™å®šå£å‘³" },
      //{ name: "çˆ†æ¼¿èŠ±ç”Ÿæ¹¯åœ“", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "çˆ†æ¼¿èŠéº»æ¹¯åœ“", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é›ªå¡©é¦™è‰å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é¦™ç”œç´«è–¯", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "ç´«è–¯Qéº»ç³¬", price: 45, category: "é™å®šå£å‘³" },
      //{ name: "ç´«è–¯èµ·å¸", price: 45, category: "é™å®šå£å‘³" },
      //{ name: "è—è“å¡å£«é”", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "ğŸ˜ˆè—è“å¡å£«é” OREO", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "è‰è“å¥¶é…¥ğŸ“", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "éµè§€éŸ³å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "é¦™è•‰å·§å…‹åŠ›", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "èŠ±ç”Ÿå·§å…‹åŠ›", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "ç‰ç±³è›‹ç‡’", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é¹¹é¦™èŠ±ç”Ÿ", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "èŠ±ç”Ÿå¡å£«é”", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "é»‘ç³–å¡å£«é”", price: 28, category: "é™å®šå£å‘³" },
      //{ name: "Oreoå¡å£«é”", price: 33, category: "é™å®šå£å‘³" },
      //{ name: "åˆæˆ€è‰è“å¡å£«é”", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "è‰è“Oreo", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "é¦™ç”œç‰ç±³èµ·å¸ğŸŒ½", price: 35, category: "é™å®šå£å‘³" },
      //{ name: "éµè§€éŸ³å¥¶é…¥", price: 38, category: "é™å®šå£å‘³" },
      //{ name: "çç éµè§€éŸ³å¥¶é…¥", price: 40, category: "é™å®šå£å‘³" },
      //{ name: "å¤§æºªåœ°é¦™è‰å¡å£«é”", price: 30, category: "é™å®šå£å‘³" },
      //{ name: "èŠ’æœå¡å£«é”", price: 33, category: "é™å®šå£å‘³" },

      { name: "ç’°ä¿æè¢‹", price: 2, category: "å…¶ä»–" },
      
      //{ name: "å‰ç¥¥ç´…è‰²", price: 79, category: "åŠ è³¼*é™é‡1ä»¶", isGift: true },
      //{ name: "å¦‚æ„ç´ºè—", price: 79, category: "åŠ è³¼*é™é‡1ä»¶", isGift: true },

    ];

    const disabledProducts = {
      //'é»‘ç³–éº»ç³¬': 'è£œè²¨ä¸­',
      // 'è‡¨æ™‚å”®å®Œçš„å“é …ï¼Œæœ‰è²¨å°±åˆªæ‰ä¸Šé¢é‚£è¡Œ'
    };


    // ===== åº—ä¼‘æ—¥è¨­å®šï¼ˆåªæ”¹é€™è£¡å°±å¥½ï¼‰=====
    // æ”¯æ´ï¼šå–®æ—¥ 'YYYY-MM-DD'
    // æ”¯æ´ï¼šå€é–“ ['YYYY-MM-DD', 'YYYY-MM-DD']ï¼ˆå«èµ·è¨–æ—¥ï¼‰
    function dateRange(start, end) {
      const result = [];
      const cur = new Date(start);
      const last = new Date(end);

      // ç”¨ UTC é¿å…æ™‚å€é€ æˆæ—¥æœŸè·³ä¸€å¤©
      cur.setHours(12, 0, 0, 0);
      last.setHours(12, 0, 0, 0);

      while (cur <= last) {
        result.push(cur.toISOString().slice(0, 10));
        cur.setDate(cur.getDate() + 1);
      }
      return result;
    }

    const HOLIDAY_RULES = [
      // å¤§é˜ªè¡Œï¼š1/29ï½2/11
      //['2026-01-29', '2026-02-11'],

      // éå¹´ï¼š2/15ï½2/18
     // ['2026-02-15', '2026-02-18'],

      // âœ… ã€Œå–®ä¸€å¤©åº—ä¼‘ã€ï¼š
       '2026-02-25',
    ];

    const holidays = new Set(
      HOLIDAY_RULES.flatMap(rule => Array.isArray(rule) ? dateRange(rule[0], rule[1]) : [rule])
    );
    // ===== åº—ä¼‘æ—¥è¨­å®šçµæŸ =====
    const state = {};

    const productListEl = document.getElementById('productList');
    const summaryEl = document.getElementById('summary');
    const dateInput = document.getElementById('pickupDate');
    const timeSelect = document.getElementById('pickupTime');
    const generateBtn = document.getElementById('generateBtn');
    const resultBox = document.getElementById('resultBox');
    const copyBtn = document.getElementById('copyBtn');

    function renderProducts() {
      const frag = document.createDocumentFragment();

      const emojis = {
        "é¹¹å£å‘³": "ğŸ§‚",
        "ç”œå£å‘³": "ğŸ°",
        "åŸå‘³": "ğŸ¥š",
        "é™å®šå£å‘³": "â³",
        "å…¶ä»–": "ğŸŒ±",
        
      };

      const categories = ["é¹¹å£å‘³", "ç”œå£å‘³", "åŸå‘³", "é™å®šå£å‘³", "å…¶ä»–"];

      categories.forEach(cat => {
        const filtered = products
          .map((item, idx) => ({ item, idx }))
          .filter(({ item }) => item.category === cat);

        if (filtered.length === 0) return; // âœ… æ²’æœ‰è©²åˆ†é¡å•†å“å°±è·³é

        const group = document.createElement('div');
        group.className = 'product-group';

        const subtitle = document.createElement('div');
        subtitle.className = 'section-subtitle';
        subtitle.textContent = `${emojis[cat] || "ğŸ½ï¸"} ${cat}`;
        group.appendChild(subtitle);

        // --- æ˜¥ç¯€æ´»å‹•ç´…å­—é–‹å§‹ ---
        // if (cat.includes("åŠ è³¼")) {
        //   const notice = document.createElement('div');
        //   notice.style = "color: #d9534f; font-size: 0.85rem; font-weight: bold; margin: 5px 0 10px 40px; display: block;";
        //   notice.textContent = "æ»¿$168å¯åŠ è³¼1ä»¶ç´…åŒ…è¢‹";
        //   group.appendChild(notice);
        // }
        // --- æ´»å‹•ç´…å­—çµæŸ ---

        filtered.forEach(({ item, idx }) => {
          state[item.name] = 0;
          const div = document.createElement('div');
          div.className = 'product';

          const isDisabled = item.name in disabledProducts;

          div.innerHTML = `
            <div class="name">${item.name} - $${item.price}</div>
            ${isDisabled ? `<div style="font-size: 0.85rem; color: #a35b5b; margin: 0.3rem 0 0.2rem;">â€» ${disabledProducts[item.name]}</div>` : ''}
            <div class="counter" data-index="${idx}">
              <button class="minus-btn" disabled>-</button>
              <input type="number" class="qty-input" id="qty-${idx}" value="0" min="0">
              <button class="plus-btn" ${isDisabled ? 'disabled' : ''}>+</button>
            </div>

          `;

          group.appendChild(div);

          if (item.name === "ç’°ä¿æè¢‹") {
            const tip = document.createElement('div');
            tip.style.cssText = "font-size: 0.9rem; color: #6a4f3b; margin: 0.3rem 0 0.8rem 0.5rem;";
            tip.textContent = " æ„›è­·åœ°çƒï¼Œæ­¡è¿è‡ªå‚™è³¼ç‰©è¢‹ â™»ï¸";
            group.appendChild(tip);
          }
        });



        frag.appendChild(group);

      });
      productListEl.appendChild(frag);
    }


    function updateSummary() {
      let total = 0, count = 0;
      products.forEach(item => {
        const qty = state[item.name] || 0;
        total += qty * item.price;
        if (item.name !== 'ç’°ä¿æè¢‹') count += qty;
      });

      // --- æ˜¥ç¯€æ´»å‹•é‚è¼¯é–‹å§‹ (ä¸éœ€è¦æ™‚è«‹è¨»è§£æ‰ä¸‹ä¸€è¡Œ) ---
     //if (typeof checkActivityRules === 'function') checkActivityRules(total, count);
      // --- æ´»å‹•é‚è¼¯çµæŸ ---

      summaryEl.textContent = `ç¸½é‡‘é¡ï¼š$${total}ï½œç¸½é¡†æ•¸ï¼š${count}`;
      return { total, count };
    }

    // æ˜¥ç¯€æ´»å‹•åˆ¤æ–·é‚è¼¯æœ¬é«”ï¼Œæ´»å‹•çµæŸåˆªé™¤
  //  function checkActivityRules(total, count) {
  //   const giftItems = ["å‰ç¥¥ç´…è‰²", "å¦‚æ„ç´ºè—"];
      
  //   // 1. è¨ˆç®—é›è›‹ç³•ç¸½é¡ (æ’é™¤åŠ è³¼å“èˆ‡æè¢‹)
  //   let cakeTotal = 0;
  //   products.forEach(item => {
  //     if (!giftItems.includes(item.name) && item.name !== 'ç’°ä¿æè¢‹') {
  //       cakeTotal += (state[item.name] || 0) * item.price;
  //     }
  //   });

  //   const isEligible = cakeTotal >= 168;
  //   let currentGiftTotal = 0;
  //   giftItems.forEach(name => currentGiftTotal += (state[name] || 0));

  //   // 2. éæ­·å•†å“ï¼Œé‡å°åŠ è³¼å“åšé–å®š
  //   products.forEach((item, idx) => {
  //     if (giftItems.includes(item.name)) {
  //       const plusBtn = document.querySelector(`.counter[data-index="${idx}"] .plus-btn`);
  //       const qtyInput = document.getElementById(`qty-${idx}`);

  //       if (plusBtn) {
  //         // åˆ¤å®šï¼šé‡‘é¡ä¸è¶³ 168 æˆ– å·²é»é¸ 1 ä»¶åŠ è³¼å“ï¼Œå°±é–æ­»æŒ‰éˆ•
  //         const shouldDisable = !isEligible || currentGiftTotal >= 1;
  //         plusBtn.disabled = shouldDisable;
  //         plusBtn.style.opacity = shouldDisable ? "0.3" : "1";
  //         plusBtn.style.pointerEvents = shouldDisable ? "none" : "auto"; // å¾¹åº•é˜²èª¤é»
  //       }

  //       // 3. åæ‚”é€£å‹•ï¼šå¦‚æœå®¢äººæ¸›å°‘é›è›‹ç³•å°è‡´é‡‘é¡ä¸è¶³ 168ï¼Œè‡ªå‹•ç§»é™¤å·²é¸çš„ç´…åŒ…è¢‹
  //       if (!isEligible && state[item.name] > 0) {
  //         state[item.name] = 0;
  //         if (qtyInput) qtyInput.value = 0;
  //         // è§¸ç™¼éåŒæ­¥æ›´æ–°ï¼ŒæŠŠ 79 å…ƒå¾ç¸½é‡‘é¡æ‰£é™¤
  //         setTimeout(() => updateSummary(), 0);
  //       }
  //     }
  //   });
  // }
   //æ˜¥ç¯€æ´»å‹•åº•éƒ¨ï¼Œè¨˜å¾—æ´»å‹•çµæŸåˆªé™¤
    
    function changeQty(idx, diff) {
      // --- é€™æ˜¯æ–°å¢çš„æ””æˆªä¿è­·ï¼Œé¿å…ç°è‰²æŒ‰éˆ•é‚„èƒ½é» ---
      const btnClass = diff > 0 ? '.plus-btn' : '.minus-btn';
      const btn = document.querySelector(`.counter[data-index="${idx}"] ${btnClass}`);
      if (btn && btn.disabled) return; 
      // -------------------------------------------

      const item = products[idx];
      const newQty = Math.max(0, (state[item.name] || 0) + diff);
      state[item.name] = newQty;

      const inputEl = document.getElementById(`qty-${idx}`);
      inputEl.value = newQty;

      const container = productListEl.querySelector(`.counter[data-index="${idx}"]`);
      container.querySelector('.minus-btn').disabled = newQty === 0;

      updateSummary();
    }


    function generateTimeSlots() {
      timeSelect.innerHTML = '';
      const val = dateInput.value;
      if (!val || holidays.has(val)) return;

      const d = new Date(val);
      const day = d.getDay();
      const isToday = val === new Date().toISOString().split('T')[0];

      const earlyOpenDays = new Set(['2026-02-19','2026-02-20']); // â¬…ï¸ æƒ³ææ—©ç‡Ÿæ¥­å“ªå¤©å°±åœ¨é€™åŠ 
      const isEarlyOpenDay = earlyOpenDays.has(val);
      const isWeekend = (day === 0 || day === 6);
      const useWeekendTime = isWeekend || isEarlyOpenDay;

      const baseHour = useWeekendTime ? 14 : 15;
      const baseMin = useWeekendTime ? 40 : 10;


      let nowHour = 0, nowMin = 0;
      if (isToday) {
        const now = new Date();
        nowHour = now.getHours();
        nowMin = now.getMinutes();
      }

      for (let h = baseHour; h < 19; h++) {
        for (let m = 0; m < 60; m += 10) {
          if (h === baseHour && m < baseMin) continue;
          if (isToday && (h < nowHour || (h === nowHour && m <= nowMin))) continue;

          const hh = String(h).padStart(2, '0');
          const mm = String(m).padStart(2, '0');
          const opt = document.createElement('option');
          opt.value = `${hh}:${mm}`;
          opt.textContent = `${hh}:${mm}`;
          timeSelect.appendChild(opt);
        }
      }
    }


    function validateForm({ total, count }) {
      if (count === 0) {
        alert('è«‹é¸æ“‡è‡³å°‘ä¸€é …å“é …');
        return false;
      }
      if (!dateInput.value) {
        alert('è«‹é¸æ“‡å–é¤æ—¥æœŸ'); return false;
      }
      if (holidays.has(dateInput.value)) {
        alert('æ­¤æ—¥ç‚ºå…¬ä¼‘æ—¥ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸ'); return false;
      }
      if (!timeSelect.value) {
        alert('è«‹é¸æ“‡å–é¤æ™‚é–“'); return false;
      }
      const phone = document.getElementById('phone');
      if (!phone.checkValidity()) {
        alert('è«‹è¼¸å…¥æ­£ç¢ºé›»è©±è™Ÿç¢¼'); phone.focus(); return false;
      }
      return true;
    }

    function generateOrder() {
      const { total, count } = updateSummary();
      if (!validateForm({ total, count })) return;
      const name = document.getElementById('customerName').value || 'é¡§å®¢';
      const phone = document.getElementById('phone').value;
      localStorage.setItem('customerName', name);
      localStorage.setItem('customerPhone', phone);
      const date = dateInput.value;
      const time = timeSelect.value;
      const note = document.getElementById('note').value;
      let text = `ã€èŠ±ç”°èˆå°åˆ¤ç‡’ é è¨‚å–®ã€‘\n` +
                 `ç¨±è¬‚ï¼š${name}\né›»è©±ï¼š${phone}\nå–é¤æ™‚é–“ï¼š${date} ${time}\n` +
                 `ç¸½é‡‘é¡ï¼š$${total}\nç¸½é¡†æ•¸ï¼š${count}\nè¨‚è³¼å…§å®¹ï¼š`;
      products.forEach(item => {
        const qty = state[item.name];
        if (qty > 0) text += `\n- ${item.name} x${qty}`;
      });



      if (note) text += `\nå‚™è¨»ï¼š${note}`;
      text += `\nâ— æœ‰æ”¶åˆ°åº—å®¶å›è¦†æ‰ä»£è¡¨è¨‚é¤æˆåŠŸå–”ï¼`;
      resultBox.textContent = text;
      resultBox.style.display = 'block';
      copyBtn.style.display = 'block';
      resultBox.scrollIntoView({ behavior: 'smooth' });
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(resultBox.textContent)
        .then(() => alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼Œè«‹è²¼åˆ° LINE å‚³é€ï¼'));
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderProducts();
      updateSummary();
      // âœ… å¾ localStorage è®€å–
        const savedName = localStorage.getItem('customerName');
        const savedPhone = localStorage.getItem('customerPhone');
        if (savedName) document.getElementById('customerName').value = savedName;
        if (savedPhone) document.getElementById('phone').value = savedPhone;

      productListEl.addEventListener('click', e => {
        const counter = e.target.closest('.counter');
        if (!counter) return;
        const idx = Number(counter.dataset.index);
        if (e.target.classList.contains('plus-btn')) changeQty(idx, 1);
        if (e.target.classList.contains('minus-btn')) changeQty(idx, -1);
      });

      // âœ… â• ç¨ç«‹ç›£è½è¼¸å…¥æ¡†è®Šå‹•
      productListEl.addEventListener('input', e => {
        if (!e.target.classList.contains('qty-input')) return;

        const idx = Number(e.target.closest('.counter').dataset.index);
        const item = products[idx];
        let value = parseInt(e.target.value, 10);

        if (isNaN(value) || value < 0) value = 0;

        //æ˜¥ç¯€æ´»å‹•åŠ è³¼è¼¸å…¥æ¡†ï¼Œæ´»å‹•çµæŸåˆªé™¤
        // const giftItems = ["å‰ç¥¥ç´…è‰²", "å¦‚æ„ç´ºè—"];
        // if (giftItems.includes(item.name)) {
        //   if (value > 1) value = 1; // å¼·åˆ¶ä¸å‡†è¶…é 1
          
        //   // æª¢æŸ¥ã€Œé›è›‹ç³•é‡‘é¡ã€æ˜¯å¦é”æ¨™ï¼Œæ²’é”æ¨™ä¸å‡†è¼¸å…¥
        //   let cakeTotal = 0;
        //   products.forEach(p => {
        //     if (!giftItems.includes(p.name) && p.name !== 'ç’°ä¿æè¢‹') {
        //       cakeTotal += (state[p.name] || 0) * p.price;
        //     }
        //   });
        //   if (cakeTotal < 168) value = 0;
        // }
        //æ˜¥ç¯€æ´»å‹•è¼¸å…¥æ¡†åº•éƒ¨

        state[item.name] = value;
        e.target.value = value;

        const container = e.target.closest('.counter');
        const minusBtn = container.querySelector('.minus-btn');
        minusBtn.disabled = value === 0;

        updateSummary();
      });


      const today = new Date().toISOString().split('T')[0];
      dateInput.min = today;
      dateInput.addEventListener('change', () => {
        if (!dateInput.value) return;
        if (holidays.has(dateInput.value)) {
          alert('æ­¤æ—¥ç‚ºå…¬ä¼‘æ—¥'); dateInput.value = '';
          timeSelect.innerHTML = '';
          return;
        }
        generateTimeSlots();
      });
      generateBtn.addEventListener('click', generateOrder);
      copyBtn.addEventListener('click', copyToClipboard);

      let hasShownLatePickupNotice = false;

      document.getElementById('pickupTime').addEventListener('change', function () {
        const selected = this.value;
        if (!selected) return;

        const [hour, minute] = selected.split(':').map(Number);
        const selectedMinutes = hour * 60 + minute;

        if (selectedMinutes > 17 * 60 + 30 && !hasShownLatePickupNotice) {
          hasShownLatePickupNotice = true;
          alert(`â€» èŠ±ç”°èˆçš„å°åˆ¤ç‡’éƒ½æ˜¯ã€Œç¾é»ç¾åšã€æ¯æ—¥æ–°é®®é™é‡ã€ã€‚\n\nè‹¥æ‚¨é å®šçš„å–é¤æ™‚é–“è¶…é 17:30ï¼Œæˆ‘å€‘æœƒç›¡åŠ›ç‚ºæ‚¨ä¿ç•™ï¼Œä½†æœ‰æ™‚ç¾å ´å®¢äººè¼ƒå¤šï¼Œå¯èƒ½æœƒæå‰è³£å®Œã€‚\n\nè‹¥ç•¶æ—¥å·²å”®å®Œï¼Œæˆ‘æœƒä¸»å‹•é€é LINE è¨Šæ¯é€šçŸ¥æ‚¨å–æ¶ˆé è¨‚å–®ï¼Œè¬è¬æ‚¨çš„é«”è«’èˆ‡æ”¯æŒï½ ğŸ’›`);
        }
      });

    });
  })();
  </script>
  <script>
    // è‡ªå‹•é™„åŠ ç¶²å€åƒæ•¸ï¼Œé¿å…å¿«å–
    (function () {
        const url = new URL(window.location.href);
        const timestamp = Date.now().toString();
        if (!url.searchParams.has('v')) {
        url.searchParams.set('v', timestamp);
        window.location.replace(url.href);
        }
    })();
</script>

<!-- åœ–ç‰‡æ”¾å¤§ç”¨ Lightbox -->
<div id="lightbox" style="
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index:9999;
">
  <img id="lightboxImg" style="
    max-width:90%;
    max-height:85%;
    border-radius:16px;
    box-shadow:0 20px 40px rgba(0,0,0,0.6);
  ">
</div>

<script>
const envelope = document.getElementById("envelopeImg");
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightboxImg");

if(envelope){
  envelope.addEventListener("click", () => {
    lightbox.style.display = "flex";
    lightboxImg.src = envelope.src;
  });
}

lightbox.addEventListener("click", () => {
  lightbox.style.display = "none";
});
</script>

</body>
</html>
